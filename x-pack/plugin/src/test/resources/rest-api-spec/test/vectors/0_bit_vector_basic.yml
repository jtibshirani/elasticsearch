setup:
  - skip:
      features: headers
      version: " - 7.2.99"
      reason: "dense_vector functions were added from 7.3"

  - do:
      indices.create:
        index: test-index
        body:
          settings:
            number_of_replicas: 0
          mappings:
            properties:
              my_bit_vector:
                 type: bit_vector
                 dims: 5
  - do:
      index:
        index: test-index
        id: 0
        body:
          my_bit_vector: [false, false, true, true, false]

  - do:
      index:
        index: test-index
        id: 1
        body:
          my_bit_vector: [true, true, true, true, true]

  - do:
      index:
        index: test-index
        id: 2
        body:
          my_bit_vector: [true, true, true, false, true]

  - do:
      indices.refresh: {}

---
"Hamming distance":
  - do:
      search:
        rest_total_hits_as_int: true
        body:
          query:
            script_score:
              query: {match_all: {} }
              script:
                source: "1.0 / (1.0 + hammingDistance(params.query_vector, 'my_bit_vector'))"
                params:
                  query_vector: [true, true, true, false, false]

  - match: {hits.total: 3}

  - match: {hits.hits.0._id: "2"}
  - match: {hits.hits.1._id: "1"}
  - match: {hits.hits.2._id: "0"}




